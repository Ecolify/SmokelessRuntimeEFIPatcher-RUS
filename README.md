# SREP на Русском
Копия утилиты за авторством SmokelessCPU, но с маленьким дополнением.

# В чем разница в сравнении с оригиналом
* Написал несколько комментариев в файлах исх. кода.
* Появился Рус перевод для сообщений на экране и в логе, вывод в лог был приспособлен для кодировки Unicode. Сами сообщения учащены, чтобы прогресс выполнения лучше отслеживался, и у пользователя не возникало мысли что программа зависла.
  </br>Переключение на Анг доступно через аргумент ENG (например, "SREP.efi ENG"). Но, как можно догадаться, тогда вызов SREP нужно осуществить через командную строку в Shell. Разрешается передавать параметр ENG в .nsh.
  </br>Либо можно скомпилировать патчер заново, с BOOLEAN ENG = TRUE.
* Добавил 3 новые команды: LoadGUIDandSavePE, NonamePE, NonameTE.
  </br>Могут быть полезны для применения в особых случаях. В каких - будет далее.
* Добавил поддержку абстрактных знаков (regex) для использования в строке шаблона. Классы знаков доступны [по ссылке](https://gist.github.com/kaigouthro/e8bad6a2c8df6ff13b8716027a172dc0#3-character-types).
* По умолчанию комбинация Patch - Pattern теперь заменяет все вхождения, а не только первое, которые соответствуют указанному шаблону.
  </br>Старую реализацию Patch выделил в отдельную команду FastPatch.

# Как использовать
* Скомпильте исп. файл сами, найдите его у кого-нибудь в комьюнити или загрузите со страницы релизов. Текущая версия - 0.1.6.
* Распакуйте файл на накопитель и сделайте его загрузочным.
* Создайте новый или скопируйте готовый конфиг в корень.
* Запустите.

# Синтаксис для каждой из новых команд (с примерами)
Операция в "<...>" опциональна.

    Op OpName
        GUID
    <Op Patch>
        Argument 1
        Argument 2
        Argument 3
    End
    
    #Если драйвер ещё не в памяти
    <Op Exec>

### Значение

    OpName : LoadGUIDandSavePE, NonamePE, NonameTE
    GUID : GUID драйвера для поиска
    Argument 1 : OFFSET, PATTERN, REL_NEG_OFFSET, REL_POS_OFFSET
    Argument 2 : Модификатор для Argument 1 (например, HEX шаблон)
    Argument 3 : HEX патч
    
# Добавленные команды
## LoadGUIDandSavePE
Загружает PE секцию модуля из FV по GUID. Применимо когда у модуля нет имени. Редко для патчей, так как в память загружается вторая копия модуля.
</br>Т.е. команда нужна для особых случаев когда у App, запуск которого инициирует вход в биос, нет секции UI.
</br>Что делает команду менее бесполезной это сохранение PE секции модуля как файл на флешку. Может быть применимо когда ни один способ дампа не работает.
</br>Формат GUID как в UEFITool.

    Op LoadGUIDandSavePE
    FE3542FE-C1D3-4EF8-657C-8048606FF670

## NonamePE, NonameTE
Используют одну и ту-же функцию, с различием в лишь одном передаваемом значении.

* NonamePE - ищет секцию PE по GUID;
* NonameTE - ищет секцию TE по GUID.
</br>Синтаксис как у LoadGUIDandSavePE, но у этих команд область поиска RAM, вместо FV.

Работает таким образом, что сначала находится модуль в FV, но не RAM, соотв. введенному GUID. Вместо имени этого модуля, в отдельную переменную кладется его размер. Затем создается массив из модулей уже попавших в RAM. И размер каждого из этих модулей сравнивается с сохраненным значением, в упомянутой отдельной переменной. При совпадении цикл сравнения останавливается, функция возвращает ImageInfo текущего модуля.

В этом подходе есть недостаток, при котором **в случае наличия модулей одинакового размера, будет выбран первый по порядку**.

# Todos

    [x] Regex Matching
    [x] Batch Replacement
    [ ] Uninstall Protocol?
    [ ] Insyde Rev. 3 Support (bottom priority)

* Regex и Batch Replacement реализованы в tag 0.1.6.
